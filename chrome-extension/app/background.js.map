{"version":3,"sources":["webpack://plex-to-vlc-chrome-extension/./app/background/scripts/src/Settings.js","webpack://plex-to-vlc-chrome-extension/webpack/bootstrap","webpack://plex-to-vlc-chrome-extension/webpack/runtime/define property getters","webpack://plex-to-vlc-chrome-extension/webpack/runtime/hasOwnProperty shorthand","webpack://plex-to-vlc-chrome-extension/webpack/runtime/make namespace object","webpack://plex-to-vlc-chrome-extension/./app/background/scripts/src/main.js"],"names":["Settings","markItemsPlayed","player","constructor","get","save","settings","chrome","storage","local","set","load","Promise","resolve","reject","items","runtime","lastError","saveSettings","undefined","Main","HOST_NAME","ACCEPTABLE_HOST_VERSION","onMessage","addListener","handleMessage","bind","onInstalled","handleOnInstalled","request","caller","callback","handleMessageWrapper","then","type","openNativeMessagePort","onDisconnected","onCheckVersionMessage","port","version","compareVersion","displayHostUpdateDialog","disconnect","ver1","ver2","split","map","s","padStart","join","onDisconnectedCallback","onMessageCallback","connectNative","onDisconnect","postMessage","sendMessageToContentScript","message","tabs","query","active","sendMessage","id"],"mappings":"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","file":"background.js","sourcesContent":["export default class Settings {\n    \n    markItemsPlayed = true;\n    player = \"default\";\n\n    constructor () {}\n\n    get() {\n        return {\n            \"markItemsPlayed\": this.markItemsPlayed,\n            \"player\": this.player\n        };\n    }\n\n    save() {\n        let settings = {\n            markItemsPlayed: this.markItemsPlayed,\n            player: this.player\n        };\n        chrome.storage.local.set(settings);\n    }\n\n    load() {\n        return new Promise((resolve, reject) => {\n            chrome.storage.local.get(null, (items) => {\n                \n                if (chrome.runtime.lastError) {\n                    return reject(chrome.runtime.lastError);\n                }\n                \n                let saveSettings = false;\n                if (items.markItemsPlayed === undefined) {\n                    items.markItemsPlayed = this.markItemsPlayed;\n                    saveSettings = true;\n                }\n                if (!items.player === undefined) {\n                    items.player = this.player;\n                    saveSettings = true;\n                }\n        \n                if (saveSettings) {\n                    this.save(items);\n                }\n        \n                this.markItemsPlayed = items.markItemsPlayed;\n                this.player = items.player;\n\n                resolve(this);\n            });\n        });\n    }\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import Settings from \"./Settings.js\";\n\nclass Main {\n\n    /**\n     * This is the host app id.\n     */\n    static HOST_NAME = \"com.soerenkampschroer.plextovlc\";\n    \n    /**\n     * Minumum companion app version.\n     */\n    static ACCEPTABLE_HOST_VERSION = \"1.4.0\";\n\n    constructor() {\n        chrome.runtime.onMessage.addListener(this.handleMessage.bind(this));\n        chrome.runtime.onInstalled.addListener(this.handleOnInstalled.bind(this));\n    }\n\n    handleMessage(request, caller, callback) {\n        this.handleMessageWrapper(request, caller, callback).then(callback);\n        return true;\n    }\n\n    async handleMessageWrapper(request, caller, callback) {\n        \n        let settings = new Settings();\n        await settings.load();\n\n        switch (request.type) {\n            case \"playback\":\n                request.player = settings.get().player;\n                this.openNativeMessagePort(request, this.onDisconnected.bind(this), this.onMessage.bind(this));       \n                return true;\n            case \"getSettings\":\n                return settings.get();\n            case \"saveSettings\":\n                settings.markItemsPlayed = request.settings.markItemsPlayed;\n                settings.player = request.settings.player;\n                settings.save(request.settings);\n                return true;\n            case \"hostVersionCheck\":\n                this.openNativeMessagePort({type: \"version\"}, this.onDisconnected.bind(this), this.onCheckVersionMessage.bind(this));\n                return true;\n        }\n    }\n\n    handleOnInstalled() {\n        // console.log('checking host app version');\n        // this.openNativeMessagePort({type: \"version\"}, this.onDisconnected.bind(this), this.onCheckVersionMessage.bind(this));\n    }\n\n    onCheckVersionMessage(request, port) {\n        if (!request.version || !this.compareVersion(Main.ACCEPTABLE_HOST_VERSION, request.version)) {\n            this.displayHostUpdateDialog();\n        }\n        port.disconnect();\n    }\n\n    compareVersion(ver1, ver2) {\n        ver1 = ver1.split(\".\").map( s => s.padStart(10) ).join(\".\");\n        ver2 = ver2.split(\".\").map( s => s.padStart(10) ).join(\".\");\n        return ver1 <= ver2;\n    }\n\n    openNativeMessagePort(request, onDisconnectedCallback, onMessageCallback) {\n        let port = chrome.runtime.connectNative(Main.HOST_NAME);\n        port.onDisconnect.addListener(onDisconnectedCallback);\n        port.onMessage.addListener(onMessageCallback);\n        port.postMessage(request);\n    }\n\n    async onMessage(request, port) {\n        let settings = new Settings();\n        await settings.load();\n        request.markItemsPlayed = settings.get().markItemsPlayed;\n        this.sendMessageToContentScript(request);\n        port.disconnect();\n    }\n\n    onDisconnected() {\n        if (chrome.runtime.lastError.message == \"Specified native messaging host not found.\"\n            || chrome.runtime.lastError.message == \"Access to the specified native messaging host is forbidden.\") {\n            this.displayHostUpdateDialog();\n        }\n    }\n\n    displayHostUpdateDialog() {\n        this.sendMessageToContentScript(\"installHost\");\n    }\n\n    sendMessageToContentScript(message) {\n        chrome.tabs.query({active: true}, function(tabs) {\n            chrome.tabs.sendMessage(tabs[0].id, message);\n        });\n    }\n}\n\nnew Main();"],"sourceRoot":""}
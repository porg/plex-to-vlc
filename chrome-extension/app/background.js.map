{"version":3,"file":"background.js","mappings":"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","sources":["webpack://plex-to-vlc-chrome-extension/./app/background/scripts/src/Settings.js","webpack://plex-to-vlc-chrome-extension/webpack/bootstrap","webpack://plex-to-vlc-chrome-extension/webpack/runtime/define property getters","webpack://plex-to-vlc-chrome-extension/webpack/runtime/hasOwnProperty shorthand","webpack://plex-to-vlc-chrome-extension/webpack/runtime/make namespace object","webpack://plex-to-vlc-chrome-extension/./app/background/scripts/src/main.js"],"sourcesContent":["export default class Settings {\n    \n    markItemsPlayed = true;\n    player = \"default\";\n\n    constructor () {}\n\n    get() {\n        return {\n            \"markItemsPlayed\": this.markItemsPlayed,\n            \"player\": this.player\n        };\n    }\n\n    save() {\n        let settings = {\n            markItemsPlayed: this.markItemsPlayed,\n            player: this.player\n        };\n        chrome.storage.local.set(settings);\n    }\n\n    load() {\n        return new Promise((resolve, reject) => {\n            chrome.storage.local.get(null, (items) => {\n                \n                if (chrome.runtime.lastError) {\n                    return reject(chrome.runtime.lastError);\n                }\n                \n                let saveSettings = false;\n                if (items.markItemsPlayed === undefined) {\n                    items.markItemsPlayed = this.markItemsPlayed;\n                    saveSettings = true;\n                }\n                if (!items.player === undefined) {\n                    items.player = this.player;\n                    saveSettings = true;\n                }\n        \n                if (saveSettings) {\n                    this.save(items);\n                }\n        \n                this.markItemsPlayed = items.markItemsPlayed;\n                this.player = items.player;\n\n                resolve(this);\n            });\n        });\n    }\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import Settings from \"./Settings.js\";\n\nclass Main {\n\n    /**\n     * This is the host app id.\n     */\n    static HOST_NAME = \"com.soerenkampschroer.plextovlc\";\n    \n    /**\n     * Minumum companion app version.\n     */\n    static ACCEPTABLE_HOST_VERSION = \"1.4.0\";\n\n    constructor() {\n        chrome.runtime.onMessage.addListener(this.handleMessage.bind(this));\n        chrome.runtime.onInstalled.addListener(this.handleOnInstalled.bind(this));\n    }\n\n    handleMessage(request, caller, callback) {\n        this.handleMessageWrapper(request, caller, callback).then(callback);\n        return true;\n    }\n\n    async handleMessageWrapper(request, caller, callback) {\n        \n        let settings = new Settings();\n        await settings.load();\n\n        switch (request.type) {\n            case \"playback\":\n                request.player = settings.get().player;\n                this.openNativeMessagePort(request, this.onDisconnected.bind(this), this.onMessage.bind(this));       \n                return true;\n            case \"getSettings\":\n                return settings.get();\n            case \"saveSettings\":\n                settings.markItemsPlayed = request.settings.markItemsPlayed;\n                settings.player = request.settings.player;\n                settings.save(request.settings);\n                return true;\n            case \"hostVersionCheck\":\n                this.openNativeMessagePort({type: \"version\"}, this.onDisconnected.bind(this), this.onCheckVersionMessage.bind(this));\n                return true;\n        }\n    }\n\n    handleOnInstalled() {\n        // console.log('checking host app version');\n        // this.openNativeMessagePort({type: \"version\"}, this.onDisconnected.bind(this), this.onCheckVersionMessage.bind(this));\n    }\n\n    onCheckVersionMessage(request, port) {\n        if (!request.version || !this.compareVersion(Main.ACCEPTABLE_HOST_VERSION, request.version)) {\n            this.displayHostUpdateDialog();\n        }\n        port.disconnect();\n    }\n\n    compareVersion(ver1, ver2) {\n        ver1 = ver1.split(\".\").map( s => s.padStart(10) ).join(\".\");\n        ver2 = ver2.split(\".\").map( s => s.padStart(10) ).join(\".\");\n        return ver1 <= ver2;\n    }\n\n    openNativeMessagePort(request, onDisconnectedCallback, onMessageCallback) {\n        let port = chrome.runtime.connectNative(Main.HOST_NAME);\n        port.onDisconnect.addListener(onDisconnectedCallback);\n        port.onMessage.addListener(onMessageCallback);\n        port.postMessage(request);\n    }\n\n    async onMessage(request, port) {\n        let settings = new Settings();\n        await settings.load();\n        request.markItemsPlayed = settings.get().markItemsPlayed;\n        this.sendMessageToContentScript(request);\n        port.disconnect();\n    }\n\n    onDisconnected() {\n        if (chrome.runtime.lastError.message == \"Specified native messaging host not found.\"\n            || chrome.runtime.lastError.message == \"Access to the specified native messaging host is forbidden.\") {\n            this.displayHostUpdateDialog();\n        }\n    }\n\n    displayHostUpdateDialog() {\n        this.sendMessageToContentScript(\"installHost\");\n    }\n\n    sendMessageToContentScript(message) {\n        chrome.tabs.query({active: true}, function(tabs) {\n            chrome.tabs.sendMessage(tabs[0].id, message);\n        });\n    }\n}\n\nnew Main();"],"names":["Settings","markItemsPlayed","player","constructor","get","save","settings","chrome","storage","local","set","load","Promise","resolve","reject","items","runtime","lastError","saveSettings","undefined","Main","HOST_NAME","ACCEPTABLE_HOST_VERSION","onMessage","addListener","handleMessage","bind","onInstalled","handleOnInstalled","request","caller","callback","handleMessageWrapper","then","type","openNativeMessagePort","onDisconnected","onCheckVersionMessage","port","version","compareVersion","displayHostUpdateDialog","disconnect","ver1","ver2","split","map","s","padStart","join","onDisconnectedCallback","onMessageCallback","connectNative","onDisconnect","postMessage","sendMessageToContentScript","message","tabs","query","active","sendMessage","id"],"sourceRoot":""}